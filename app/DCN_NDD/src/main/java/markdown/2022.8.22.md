# 增量更新
现在能实现根据配置文件验证的可达性一致
输入的是统计更新后所需要的时间

增量测试时候做的内容
输入的内容是配置文件，输出的是当前的可达性如何
需要确定的内容就是验证的起点和方式
验证的起点和具体内容到底都是什么东西

一个端口上的内容内容和后续
原子会出现划分和移动

根据这个更新可达树增量更新可达性

原则如下
每次更新后，找到moves ap
然后把movesap投入算法进行搜索。
moveaps是怎么来的

moves的element是什么意思


# 算子
push，就是顶层+1
pop，就是顶层被取消掉，然后把封装前的东西爆露出来，这个没问题，（触发repair）




# 结果
正确性是一致的
after gbr: 6776 0
start traverse
start.size()56
endEndpoint.size()58
reachability:594
total_time:555797.7715
6776



"D:\dir_Coding\Java JDK\bin\java.exe" "-javaagent:F:\dir_coding_ide\IntelliJ IDEA 2021.3.1\lib\idea_rt.jar=4083:F:\dir_coding_ide\IntelliJ IDEA 2021.3.1\bin" -Dfile.encoding=UTF-8 -classpath F:\Git\dir_Java\apkkatra\out\production\apkkatra;F:\Git\dir_Java\apkkatra\src\lib\javafx-swt.jar;F:\Git\dir_Java\apkkatra\src\lib\javafx.web.jar;F:\Git\dir_Java\apkkatra\src\lib\javafx.base.jar;F:\Git\dir_Java\apkkatra\src\lib\javafx.fxml.jar;F:\Git\dir_Java\apkkatra\src\lib\javafx.media.jar;F:\Git\dir_Java\apkkatra\src\lib\javafx.swing.jar;F:\Git\dir_Java\apkkatra\src\lib\json-20180813.jar;F:\Git\dir_Java\apkkatra\src\lib\javafx.controls.jar;F:\Git\dir_Java\apkkatra\src\lib\javafx.graphics.jar apkeep.katra.DCNKatraNetwork
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\parsed\base\topology
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\parsed\base\topology
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\parsed\base\fibs
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\parsed\base\vxlan
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\parsed\base\epg
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\parsed\base\gbp
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\parsed\base\pbr
fib rules number is: 107
after fibs: 71 time: 95
after vxlan ip encap: 75 29
after update rewrite table: 75 0
after merge: 71 5
after vxlan encap: 71 time: 37
50000
after vni identifier: 497 time: 371
after vni encap*: 602 890
after vni encap: 497 time: 1055
after vxlan ip encap: 497 time: 1055
after epg: 5467 32839
after gbr: 5467 0
start traverse
start.size()48
endEndpoint.size()48
moved_aps.size(): 5467
reachability:528
total_time:247638.9978
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post0_base\topology
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post0_base\topology
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post0_base\fibs
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post0_base\vxlan
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post0_base\epg
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post0_base\gbp
fib rules number is: 2
after fibs: 5467 time: 17
after vxlan ip encap: 5467 52
after update rewrite table: 5467 0
after merge: 5467 0
after vxlan encap: 5467 time: 52
50000
after vni identifier: 5467 time: 3
after vni encap*: 5467 69
after vni encap: 5467 time: 69
after vxlan ip encap: 5467 time: 69
after epg: 5467 0
after gbr: 5467 0
start.size()48
endEndpoint.size()48
moved_aps.size(): 154
reachability:560
total_time:43576.1519
time per inserted rule :1089.4037974999999
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post1_post0\topology
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post1_post0\topology
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post1_post0\fibs
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post1_post0\vxlan
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post1_post0\epg
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post1_post0\gbp
fib rules number is: 0
after fibs: 5467 time: 0
after vxlan ip encap: 5467 0
after update rewrite table: 5467 0
after merge: 5467 0
after vxlan encap: 5467 time: 0
after vni identifier: 5467 time: 0
after vni encap*: 5467 0
after vni encap: 5467 time: 0
after vxlan ip encap: 5467 time: 0
after epg: 5467 0
after gbr: 5467 0
start.size()48
endEndpoint.size()48
moved_aps.size(): 0
reachability:560
total_time:0.0501
time per inserted rule :0.004175
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post2_post1\topology
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post2_post1\topology
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post2_post1\fibs
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post2_post1\vxlan
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post2_post1\epg
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post2_post1\gbp
fib rules number is: 2
after fibs: 5544 time: 1336
after vxlan ip encap: 5544 24
after update rewrite table: 5544 0
after merge: 5544 0
after vxlan encap: 5544 time: 24
after vni identifier: 5544 time: 2
after vni encap*: 5544 33
after vni encap: 5544 time: 33
after vxlan ip encap: 5544 time: 33
after epg: 5544 14
after gbr: 5544 0
start.size()48
endEndpoint.size()49
moved_aps.size(): 77
reachability:567
total_time:1649.6876
time per inserted rule :44.58615135135135
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post3_post2\topology
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post3_post2\topology
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post3_post2\fibs
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post3_post2\vxlan
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post3_post2\epg
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post3_post2\gbp
fib rules number is: 2
after fibs: 5621 time: 1318
after vxlan ip encap: 5698 2855
after update rewrite table: 5698 0
after merge: 5621 4513
after vxlan encap: 5621 time: 7369
after vni identifier: 5621 time: 2
after vni encap*: 5698 2832
after vni encap: 5621 time: 6896
after vxlan ip encap: 5621 time: 6896
after epg: 5621 0
after gbr: 5621 0
start.size()48
endEndpoint.size()50
moved_aps.size(): 77
reachability:574
total_time:3498.6895
time per inserted rule :94.55917567567568
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post4_post3\topology
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post4_post3\topology
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post4_post3\fibs
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post4_post3\vxlan
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post4_post3\epg
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post4_post3\gbp
fib rules number is: 8
after fibs: 5929 time: 5909
after vxlan ip encap: 5929 104
after update rewrite table: 5929 0
after merge: 5929 0
after vxlan encap: 5929 time: 104
after vni identifier: 6776 time: 20546
after vni encap*: 7040 19252
after vni encap: 6776 time: 37955
after vxlan ip encap: 6776 time: 37955
after epg: 6776 1556
after gbr: 6776 0
start.size()56
endEndpoint.size()58
moved_aps.size(): 6776
reachability:594
total_time:455495.7783
time per inserted rule :3795.7981525
6776

Process finished with exit code 0


# tiny
"D:\dir_Coding\Java JDK\bin\java.exe" "-javaagent:F:\dir_coding_ide\IntelliJ IDEA 2021.3.1\lib\idea_rt.jar=5023:F:\dir_coding_ide\IntelliJ IDEA 2021.3.1\bin" -Dfile.encoding=UTF-8 -classpath F:\Git\dir_Java\apkkatra\out\production\apkkatra;F:\Git\dir_Java\apkkatra\src\lib\javafx-swt.jar;F:\Git\dir_Java\apkkatra\src\lib\javafx.web.jar;F:\Git\dir_Java\apkkatra\src\lib\javafx.base.jar;F:\Git\dir_Java\apkkatra\src\lib\javafx.fxml.jar;F:\Git\dir_Java\apkkatra\src\lib\javafx.media.jar;F:\Git\dir_Java\apkkatra\src\lib\javafx.swing.jar;F:\Git\dir_Java\apkkatra\src\lib\json-20180813.jar;F:\Git\dir_Java\apkkatra\src\lib\javafx.controls.jar;F:\Git\dir_Java\apkkatra\src\lib\javafx.graphics.jar apkeep.katra.DCNKatraNetwork
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\parsed\base\topology
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\parsed\base\topology
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\parsed\base\fibs
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\parsed\base\vxlan
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\parsed\base\pbr
fib rules number is: 107
after fibs: 71 time: 78
after vxlan ip encap: 75 30
after update rewrite table: 75 0
after merge: 71 3
after vxlan encap: 71 time: 38
50000
after vni identifier: 497 time: 382
after vni encap*: 602 647
after vni encap: 497 time: 740
after vxlan ip encap: 497 time: 740
start traverse
start.size()48
endEndpoint.size()48
moved_aps.size(): 496
reachability:528
total_time:500.9127
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post0_base\topology
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post0_base\topology
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post0_base\fibs
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post0_base\vxlan
fib rules number is: 2
after fibs: 497 time: 2
after vxlan ip encap: 497 3
after update rewrite table: 497 0
after merge: 497 0
after vxlan encap: 497 time: 3
50000
after vni identifier: 497 time: 0
after vni encap*: 497 3
after vni encap: 497 time: 3
after vxlan ip encap: 497 time: 3
start.size()48
endEndpoint.size()48
moved_aps.size(): 14
reachability:560
total_time:47.9816
time per inserted rule :1.19954
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post1_post0\topology
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post1_post0\topology
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post1_post0\fibs
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post1_post0\vxlan
fib rules number is: 0
after fibs: 497 time: 0
after vxlan ip encap: 497 0
after update rewrite table: 497 0
after merge: 497 0
after vxlan encap: 497 time: 0
after vni identifier: 497 time: 0
after vni encap*: 497 0
after vni encap: 497 time: 0
after vxlan ip encap: 497 time: 0
start.size()48
endEndpoint.size()48
moved_aps.size(): 0
reachability:560
total_time:0.0478
time per inserted rule :0.0478
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post2_post1\topology
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post2_post1\topology
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post2_post1\fibs
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post2_post1\vxlan
fib rules number is: 2
after fibs: 504 time: 3
after vxlan ip encap: 504 1
after update rewrite table: 504 0
after merge: 504 0
after vxlan encap: 504 time: 1
after vni identifier: 504 time: 0
after vni encap*: 504 1
after vni encap: 504 time: 1
after vxlan ip encap: 504 time: 1
start.size()48
endEndpoint.size()49
moved_aps.size(): 7
reachability:567
total_time:6.6036
time per inserted rule :0.17847567567567568
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post3_post2\topology
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post3_post2\topology
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post3_post2\fibs
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post3_post2\vxlan
fib rules number is: 2
after fibs: 511 time: 3
after vxlan ip encap: 518 5
after update rewrite table: 518 0
after merge: 511 3
after vxlan encap: 511 time: 9
after vni identifier: 511 time: 0
after vni encap*: 518 4
after vni encap: 511 time: 7
after vxlan ip encap: 511 time: 7
start.size()48
endEndpoint.size()50
moved_aps.size(): 7
reachability:574
total_time:7.7501
time per inserted rule :0.20946216216216215
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post4_post3\topology
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post4_post3\topology
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post4_post3\fibs
F:\Git\dir_Java\apkkatra\src\dataset\APKeep_6\update\post4_post3\vxlan
fib rules number is: 8
after fibs: 539 time: 18
after vxlan ip encap: 539 5
after update rewrite table: 539 0
after merge: 539 0
after vxlan encap: 539 time: 5
after vni identifier: 616 time: 44
after vni encap*: 640 33
after vni encap: 616 time: 59
after vxlan ip encap: 616 time: 59
start.size()56
endEndpoint.size()58
moved_aps.size(): 105
reachability:594
total_time:240.0137
time per inserted rule :2.0001141666666666
616

Process finished with exit code 0




# d 
core-0-1_vpn2
[89217, 89331, 89525, 89559, 89274, 89388, 89468]
APSTACK
[89217, 89331, 89525, 89559, 89274, 89388, 89468]
[89525]
[89525]
[25524]
[89525]
[89217, 89331, 89525, 89559, 89274, 89388, 89468]
[89217, 89331, 89525, 89559, 89274, 89388, 89468]
[89217, 89331, 89525, 89559, 89274, 89388, 89468]
[89525] 
[89525] 到了vc，并且拆出来了
[25524] 到了decapip
[25524] 转发到core-0-1
[25524] 封装ip后的结果，leaf-0-1到spine-0-1 leaf-0-1
[89525] 封装vni后的内容，一个ip的七个不同类型的vni，封装后就一个原子了很合理 leaf-0-1_vpn2_encapip
[89217, 89331, 89525, 89559, 89274, 89388, 89468] 封装前的内容  leaf-0-1_vpn2_encapvni
[89217, 89331, 89525, 89559, 89274, 89388, 89468]  leaf-0-1_vpn2
[] 开始 leaf-0-1_vpn2
PORT_APS_RAW
vxlan [89217, 28035, 21252, 59722, 58379, 43855, 89559, 19032, 25562, 46362, 36124, 51805, 56221, 62174, 38815, 22435, 30184, 34541, 89388, 89331, 46196, 89525, 62134, 52343, 58423, 59768, 89274, 89468]
vbdif2 [61920, 48097, 61876, 38892, 21134, 29630, 55822]
vpn3 [62560, 31521, 18627, 37860, 62518, 55580, 43325]
vpn1 [28900, 42980, 18309, 62255, 62297, 51226, 34139]
HISTORY
leaf-0-1_vpn2
leaf-0-1_vpn2_encapvni
leaf-0-1_vpn2_encapip
leaf-0-1
spine-0-1
core-0-1 8000
core-0-1_decapip 2000 1000
core-0-1_vc 2000 1000
core-0-1_vpn2_decapvni（）2000 1000 1100 1200.....
core-0-1_vpn2（这个是一个转发，从这里开始） 2000 1000 1100 1200.....
//从这个地方开始一个去vpnN了，另外一个去vbdif了
去vbdif的就不考虑了
假设一个是去vpn5的，这个时候要开始变小了。
core-0-1_vpn2_encapvni
core-0-1_vpn2_encapip
core-0-1
core-0-1_decapip
core-0-1_vc
core-0-1_vpn2_decapvni



parsed/base
+ fwd core-0-1 855638017 32 vxlan 32
post2_post1/vxlan
+ vxlan core-0-1_vpn2 1342177792 24 855638017 32 24
post2_post1/fibs
+ fwd core-0-1_vpn2 1342177792 24 vxlan 24
+ vxlan core-0-1_vpn2(.*)855638017 32


core-0-1_vpn4_encapip
[43127, 46557, 47085]
APSTACK
[63842, 37603, 52228, 23492, 31336, 63884, 27276, 47085, 20270, 36911, 62383, 50352, 61268, 30774, 16630, 43127, 51482, 46557, 62429, 61310, 34847]
[63842, 37603, 52228, 23492, 31336, 63884, 27276, 47085, 20270, 36911, 62383, 50352, 61268, 30774, 16630, 43127, 51482, 46557, 62429, 61310, 34847]
[]
PORT_APS_RAW
838860801 [37603, 52228, 20270, 61268, 30774, 43127, 61310]
838860802 [27276, 47085, 36911, 62383, 16630, 51482, 62429]
838860803 [63842, 23492, 31336, 63884, 50352, 46557, 34847]
HISTORY
core-0-1_vpn4
core-0-1_vpn4_encapvni

